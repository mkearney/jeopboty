<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>README.html</title>

</head>

<body>

<h1>My #jeopboty bot</h1>

<h2>Reading data and the [correct] Twitter token</h2>

<p>load rtweet</p>

<p><code>r
library(rtweet)
</code></p>

<p>If you haven't created and saved a personal access
Twitter API token, do it now following these instructions:</p>

<p><code>r
vignette("auth", "rtweet")
</code></p>

<p>Make sure you've given the token "write" access (permission)
which you can check through your Twitter account.
Uncomment next line to open browser to Twitter's app page.
browseURL("https://apps.twitter.com")</p>

<p>If you already saved your token as an environment variable, you can
fetch it using the get_tokens() function.</p>

<p><code>r
token &lt;- get_tokens()
</code></p>

<p>I have a token I use exclusively for my #jeopboty statuses,
so I've saved that in my data folder (note: token won't
appear in my Github repository; nice try!)</p>

<p><code>r
token &lt;- readRDS("/Users/mwk/rtw.rds")
</code></p>

<p>Get the screen name associated with your token.</p>

<p><code>r
my_screen_name &lt;- token$credentials$screen_name
</code></p>

<p>This should print out YOUR screen name:</p>

<p><code>r
my_screen_name
</code></p>

<p>Read jeopardy data.</p>

<p><code>r
jeop &lt;- readRDS("../data/joepardy.rds")
</code></p>

<h2>Posting the CLUE status on Twitter</h2>

<p>Randomly select a question.</p>

<p><code>r
i &lt;- sample(seq_len(NROW(jeop)), 1L)
</code></p>

<p>Compose CLUE status.</p>

<p><code>r
clue &lt;- paste0("Clue: ", jeop$clue[i], " #jeopboty")
</code></p>

<p>Post CLUE status to Twitter.</p>

<p><code>r
post_tweet(clue, token = token)
</code></p>

<h2>Keeping track of questions you've tweeted over time</h2>

<p>Either extract and update or create "used" data object.</p>

<p>``` r
if ("used" %in% names(attributes(jeop))) {
    ## Extract used data attribute
    used &lt;- attr(jeop, "used")</p>

<pre><code>## Determine clue [number] n post.
n &lt;- NROW(used[["id"]]) + 1L

## Update (append) used object
used[["id"]][n] &lt;- n
used[["datetime"]][n] &lt;- Sys.time()
used[["clue"]][n] &lt;- jeop$clue[i]
used[["answer"]][n] &lt;- jeop$answer[i]
</code></pre>

<p>} else {
    ## Create used object.
    used &lt;- data.frame(
        id = n,
        datetime = Sys.time(),
        clue = jeop$clue[i],
        answer = jeop$answer[i])
}
```</p>

<p>Add "used" data attribute to "jeop" data.</p>

<p><code>r
attr(jeop, "used") &lt;- used
</code></p>

<p>Save data (dropping the row that was just posted.</p>

<p><code>r
saveRDS(jeop[-i, ], "/Users/mwk/r/joepardy.rds")
</code></p>

<h2>Posting the ANSWER status on Twitter</h2>

<p>Get recent timeline data for your account.</p>

<p><code>r
tw &lt;- get_timeline(my_screen_name)
</code></p>

<p>Find and return status ID of most recent clue.</p>

<p><code>r
status_id &lt;- tw$status_id[grep("^Clue", tw$text)[1]]
</code></p>

<p>Use the status ID to create quote link.</p>

<p><code>r
quote &lt;- paste0("https://twitter.com/",
                my_screen_name,
                "/status/",
                status_id)
</code></p>

<p>Compose ANSWER status.</p>

<p><code>r
answer &lt;- paste0(
    "Answer: ", jeop$answer[i], " #jeopboty ", quote)
</code></p>

<p>Post ANSWER status to Twitter.</p>

<p><code>r
post_tweet(answer, token = token)
</code></p>

</body>
</html>
